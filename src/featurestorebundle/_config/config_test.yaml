parameters:
  datalake:
    base_path: '/foo/bar'
  databricksbundle:
    databricks_connect:
      connection:
        token: 123
  featurestorebundle:
    metadata:
      display_in_notebook: False
    checkpoint:
      default_checkpoint_dir: '/tmp/checkpoints'
    orchestration:
      # we want to avoid checkpointing locally
      checkpoint_feature_results: False
      checkpoint_before_merge: False
      clean_checkpoint_dir: False
      features_join:
         method: 'union_with_window' # available: union_with_window, left_with_checkpointing
         batch_size: 9999

services:
  featurestorebundle.test.SparkSessionFactory:

  pyspark.sql.session.SparkSession:
    factory: ['@featurestorebundle.test.SparkSessionFactory', 'create']

  featurestorebundle.notebook.services.NotebookMetadataGetter:
    class: featurestorebundle.test.mock.DummyNotebookMetadataGetter

  featurestorebundle.databricks.repos.DatabricksRepositoryUrlResolver:
    class: featurestorebundle.test.mock.DummyRepositoryUrlResolver

  featurestorebundle.entity.EntityGetter:
    class: featurestorebundle.test.mock.DummyEntityGetter

  featurestorebundle.db.TableNames:
    arguments:
      feature_tables: '%featurestorebundle.feature%'
      metadata_tables: '%featurestorebundle.metadata%'
      target_tables: '%featurestorebundle.target%'
      current_branch_resolver: '@featurestorebundle.databricks.repos.DatabricksCurrentBranchResolver'

  featurestorebundle.feature.FeaturesGetter:
    arguments:
      logger: '@featurestorebundle.logger'
      entity_getter: '@featurestorebundle.entity.EntityGetter'

  featurestorebundle.feature.FeatureStore:
    arguments:
      entity_getter: '@featurestorebundle.entity.EntityGetter'

  featurestorebundle.orchestration.Serializer:
    arguments:
      entity_getter: '@featurestorebundle.entity.EntityGetter'

  featurestorebundle.widgets.WidgetsFactory:
    arguments:
      defaults: '%featurestorebundle.widgets.defaults%'
      entities: '%featurestorebundle.entities%'
      stages: '%featurestorebundle.orchestration.stages%'
      logger: '@featurestorebundle.logger'
      entity_getter: '@featurestorebundle.entity.EntityGetter'
