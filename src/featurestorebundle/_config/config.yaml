parameters:
  featurestorebundle:
    base_db: '%kernel.environment%_feature_store'
    base_path: 'dbfs:/%featurestorebundle.base_db%'
    feature:
      base_db: '%featurestorebundle.base_db%'
      base_path: '%featurestorebundle.base_path%'
      latest_table:
        db_template: '{database}'
        table_template: 'features_{entity}'
        path_template: '%featurestorebundle.feature.base_path%/features/{entity}/latest.delta'
      target_table:
        db_template: '{database}_target'
        table_template: 'features_{entity}_{target}'
        path_template: '%featurestorebundle.feature.base_path%/features/{entity}/target/{target}.delta'
      archive_table:
        db_template: '{database}_archive'
        table_template: 'features_{entity}_{timestamp}'
        path_template: '%featurestorebundle.feature.base_path%/features/{entity}/archive/{timestamp}.delta'
      defaults:
        category: 'default'
        owner: 'unknown'
        tags: []
        start_date: 2018-01-01 00:00:00
        frequency: 'daily'
    metadata:
      base_db: '%featurestorebundle.base_db%'
      base_path: '%featurestorebundle.base_path%'
      latest_table:
        db_template: '{database}'
        table_template: 'metadata_{entity}'
        path_template: '%featurestorebundle.metadata.base_path%/metadata/{entity}/latest/metadata.delta'
      target_table:
        db_template: '{database}_target'
        table_template: 'metadata_{entity}_{target}'
        path_template: '%featurestorebundle.metadata.base_path%/metadata/{entity}/target/{target}/metadata.delta'
      display_in_notebook: True
    target:
      base_db: '%kernel.environment%_target_store'
      base_path: 'dbfs:/%kernel.environment%_target_store'
      table:
        db_template: '%featurestorebundle.target.base_db%'
        table_template: 'targets_{entity}'
        path_template: '%featurestorebundle.target.base_path%/targets/{entity}.delta'
      enum_table:
        db_template: '%featurestorebundle.target.base_db%'
        table_template: 'targets_enum'
        path_template: '%featurestorebundle.target.base_path%/targets/targets_enum.delta'
    checkpoint:
      default_checkpoint_dir: 'dbfs:/tmp/checkpoints'
    orchestration:
      timestamp_shift: '-0d'
      num_parallel: 1
      checkpoint_feature_results: False
      checkpoint_before_merge: False
      clean_checkpoint_dir: False
      features_join:
        method: 'union_with_window' # available: union_with_window, left_with_checkpointing
        batch_size: 1
      stages:
      post_actions:
    entities:
    widgets:
      defaults:
        sample: 'complete'
    time_windows:
    sampling:
      rate: 0.01
      seed: 42
    stable_feature_store:
      metadata:
        base_db:
      target:
        base_db:

services:
  featurestorebundle.logger:
    class: logging.Logger
    factory: ['@loggerbundle.LoggerFactory', 'create']
    arguments:
      - 'feature_store'

  featurestorebundle.db.TableNames:
    arguments:
      - '%featurestorebundle.feature%'
      - '%featurestorebundle.metadata%'
      - '%featurestorebundle.target%'

  featurestorebundle.entity.EntityGetter:
    arguments:
      - '%featurestorebundle.entities%'

  featurestorebundle.feature.ChangesCalculator:

  featurestorebundle.feature.FeatureListFactory:

  featurestorebundle.feature.FeatureNamesValidator:

  featurestorebundle.feature.FeaturesGetter:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.feature.FeatureStore:

  featurestorebundle.feature.FeaturesValidator:

  featurestorebundle.feature.FeatureTemplateMatcher:

  featurestorebundle.feature.NullHandler:

  featurestorebundle.feature.reader.FeaturesTableReader:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.feature.writer.AddColumnsQueryBuilder:

  featurestorebundle.feature.writer.FeaturesJoiner:
    arguments:
      - !tagged_aliased ['dataframe.joiner', '%featurestorebundle.orchestration.features_join.method%']

  featurestorebundle.feature.writer.FeaturesMergeConfigGenerator:

  featurestorebundle.feature.writer.FeaturesPreparer:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.feature.writer.FeaturesTableDataHandler:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.feature.writer.FeaturesTablePreparer:

  featurestorebundle.feature.writer.FeaturesTableRegistrator:

  featurestorebundle.feature.writer.FeaturesTableWriter:

  featurestorebundle.feature.writer.LatestSnapshotCreator:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.feature.getter.FeaturesGetterFacade:

  featurestorebundle.feature.getter.LatestFeaturesGetter:

  featurestorebundle.feature.getter.TargetFeaturesGetter:

  featurestorebundle.metadata.DescriptionFiller:

  featurestorebundle.metadata.MetadataHTMLDisplayer:

  featurestorebundle.metadata.MetadataValidator:

  featurestorebundle.metadata.reader.MetadataTableReader:
    arguments:
      - '@featurestorebundle.logger'
      - '%featurestorebundle.stable_feature_store%'

  featurestorebundle.metadata.writer.MetadataTableDataHandler:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.metadata.writer.MetadataTablePreparer:

  featurestorebundle.metadata.writer.MetadataTableWriter:

  featurestorebundle.metadata.filter.MetadataFilterer:

  featurestorebundle.metadata.getter.MetadataGetter:

  featurestorebundle.target.reader.TargetsTableReader:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.target.filter.TargetsFilterer:

  featurestorebundle.target.getter.TargetsGetter:

  featurestorebundle.dataframe.DataFrameSchemaMerger:

  featurestorebundle.dataframe.EmptyDataFrameCreator:

  featurestorebundle.dataframe.join.LeftWithCheckpointingJoiner:
    arguments:
      - '%featurestorebundle.orchestration.features_join.batch_size%'
    tags:
      - {name: 'dataframe.joiner', alias: 'left_with_checkpointing'}

  featurestorebundle.dataframe.join.UnionWithWindowJoiner:
    tags:
      - {name: 'dataframe.joiner', alias: 'union_with_window'}

  featurestorebundle.table.TableCreator:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.table.TableExistenceChecker:

  featurestorebundle.table.TableSchemaMerger:

  featurestorebundle.checkpoint.CheckpointDirHandler:
    arguments:
      - '@featurestorebundle.logger'
      - '%featurestorebundle.checkpoint.default_checkpoint_dir%'

  featurestorebundle.checkpoint.CheckpointGuard:
    arguments:
      - '%featurestorebundle.orchestration.checkpoint_feature_results%'
      - '%featurestorebundle.orchestration.checkpoint_before_merge%'
      - '%featurestorebundle.orchestration.clean_checkpoint_dir%'

  featurestorebundle.frequency.FrequencyChecker:

  featurestorebundle.frequency.FrequencyGuard:

  featurestorebundle.databricks.repos.DatabricksCurrentBranchResolver:

  featurestorebundle.databricks.repos.DatabricksRepositoryUrlResolver:

  featurestorebundle.databricks.featurestore.DatabricksFeatureStoreClientFactory:

  featurestorebundle.databricks.featurestore.DatabricksFeatureStoreCreator:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.databricks.featurestore.DatabricksFeatureStoreDataHandler:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.databricks.featurestore.DatabricksFeatureStoreExistenceChecker:

  featurestorebundle.databricks.featurestore.DatabricksFeatureStorePreparer:

  featurestorebundle.orchestration.DatabricksOrchestrator:
    arguments:
      - '@featurestorebundle.logger'
      - '%featurestorebundle.orchestration.stages%'
      - '%featurestorebundle.orchestration.num_parallel%'

  featurestorebundle.orchestration.NotebookDefinitionGetter:
    arguments:
      - '%featurestorebundle.orchestration%'

  featurestorebundle.orchestration.NotebookTasksFactory:

  featurestorebundle.orchestration.PostActionsRunner:
    arguments:
      - '@featurestorebundle.logger'
      - '%featurestorebundle.orchestration.post_actions%'

  featurestorebundle.orchestration.Serializer:

  featurestorebundle.notebook.services.NotebookMetadataGetter:

  featurestorebundle.notebook.services.TimestampAdder:
    arguments:
      - '%featurestorebundle.orchestration.timestamp_shift%'
      - '%featurestorebundle.time_windows%'
      - '@featurestorebundle.logger'
      - '%featurestorebundle.sampling%'

  featurestorebundle.widgets.WidgetsFactory:
    arguments:
      - '@featurestorebundle.logger'
      - '%featurestorebundle.widgets.defaults%'
      - '%featurestorebundle.entities%'
      - '%featurestorebundle.orchestration.stages%'

  featurestorebundle.widgets.WidgetsGetter:

  featurestorebundle.widgets.WidgetNames:

  featurestorebundle.utils.DateParser:

  featurestorebundle.utils.ColumnChecker:
