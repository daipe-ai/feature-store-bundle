parameters:
  featurestorebundle:
    db_name_template: '%kernel.environment%_feature_store'
    latest_table_name_template: 'features_{entity}_latest'
    historized_table_name_template: 'features_{entity}_historized'
    base_path: 'dbfs:/%kernel.environment%_feature_store'
    latest_path_template: '%featurestorebundle.base_path%/latest/{entity}.delta'
    historized_path_template: '%featurestorebundle.base_path%/historized/{entity}.delta'
    archive_path_template: '%featurestorebundle.base_path%/archive/{entity}/{date}.delta'
    join_batch_size: 10
    writer: delta

services:
  featurestorebundle.logger:
    class: logging.Logger
    factory: ['@loggerbundle.LoggerFactory', 'create']
    arguments:
      - 'feature_store'

  featurestorebundle.db.TableNames:
    arguments:
      - '%featurestorebundle.db_name_template%'
      - '%featurestorebundle.latest_table_name_template%'
      - '%featurestorebundle.historized_table_name_template%'
      - '%featurestorebundle.latest_path_template%'
      - '%featurestorebundle.historized_path_template%'
      - '%featurestorebundle.archive_path_template%'

  featurestorebundle.delta.DeltaMergeConfigGenerator:

  featurestorebundle.delta.DeltaDataHandler:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.delta.DeltaWriter:
    tags:
      - {name: 'feature.writer', alias: 'delta'}

  featurestorebundle.databricks.DatabricksFeatureStoreWriter:
    tags:
      - {name: 'feature.writer', alias: 'databricks'}

  featurestorebundle.databricks.DatabricksDataHandler:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.feature.EmptyTableCreator:

  featurestorebundle.feature.FeatureManager:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.feature.FeatureTemplateMatcher:

  featurestorebundle.feature.FeatureStore:

  featurestorebundle.metadata.MetadataWriter:
    arguments:
      - '@featurestorebundle.logger'

  featurestorebundle.metadata.MetadataTablePreparer:

  featurestorebundle.metadata.MetadataHTMLDisplayer:

  featurestorebundle.metadata.TimeWindowHandler:

  featurestorebundle.feature.TablePreparer:

  featurestorebundle.feature.FeaturesValidator:

  featurestorebundle.feature.FeaturesPreparer:
    arguments:
      - '%featurestorebundle.join_batch_size%'
